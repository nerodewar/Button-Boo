<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Button Boo (v1)</title>

  <!-- Retro arcade font (online). If you want offline, download and self-host. -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#020617;
      --bg1:#06102a;
      --bg2:#0b1d4a;

      --text:#F4F8FF;
      --muted:rgba(214,230,255,0.80);

      --glass: rgba(10, 24, 58, 0.42);

      --primary: #8FF3FF;
      --primary2:#A8A0FF;

      --radius: 22px;
      --shadow: 0 24px 70px rgba(0,0,0,.55);

      /* Buttons */
      --arcadeRed1:#ff2d2d;
      --arcadeRed2:#b00018;
      --arcadeBlue1:#2aa8ff;
      --arcadeBlue2:#0a4ee6;

      --tap: 92px; /* toddler-safe tap size */
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;

      /* Ice/Aurora base */
      background:
        radial-gradient(1100px 600px at 14% 12%, rgba(143,243,255,0.18), rgba(0,0,0,0) 55%),
        radial-gradient(900px 560px at 86% 22%, rgba(168,160,255,0.20), rgba(0,0,0,0) 60%),
        radial-gradient(900px 650px at 50% 110%, rgba(88,200,255,0.10), rgba(0,0,0,0) 65%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 55%, var(--bg2));
      overflow-x:hidden;
    }

    /* =========================
       üåå Cosmic Starry Night BG
       (layout-safe: fixed layers)
       ========================= */
    body::before{
      content:"";
      position:fixed;
      inset:-2px;
      pointer-events:none;
      z-index:0;

      background:
        /* tiny stars */
        radial-gradient(1px 1px at 8% 16%,  rgba(255,255,255,.70), rgba(0,0,0,0) 2px),
        radial-gradient(1px 1px at 18% 72%, rgba(255,255,255,.55), rgba(0,0,0,0) 2px),
        radial-gradient(1px 1px at 32% 28%, rgba(255,255,255,.62), rgba(0,0,0,0) 2px),
        radial-gradient(1px 1px at 56% 44%, rgba(255,255,255,.48), rgba(0,0,0,0) 2px),
        radial-gradient(1px 1px at 76% 18%, rgba(255,255,255,.66), rgba(0,0,0,0) 2px),
        radial-gradient(1px 1px at 90% 62%, rgba(255,255,255,.52), rgba(0,0,0,0) 2px),

        /* mid stars */
        radial-gradient(1.6px 1.6px at 14% 40%, rgba(210,240,255,.55), rgba(0,0,0,0) 3px),
        radial-gradient(1.6px 1.6px at 44% 12%, rgba(235,225,255,.50), rgba(0,0,0,0) 3px),
        radial-gradient(1.6px 1.6px at 68% 78%, rgba(215,245,255,.48), rgba(0,0,0,0) 3px),
        radial-gradient(1.6px 1.6px at 82% 36%, rgba(255,255,255,.46), rgba(0,0,0,0) 3px),

        /* bright ‚Äúglisten‚Äù stars */
        radial-gradient(2.2px 2.2px at 24% 22%, rgba(255,255,255,.85), rgba(0,0,0,0) 4px),
        radial-gradient(2.2px 2.2px at 62% 30%, rgba(255,255,255,.78), rgba(0,0,0,0) 4px),
        radial-gradient(2.2px 2.2px at 74% 58%, rgba(255,255,255,.70), rgba(0,0,0,0) 4px),

        /* subtle cosmic dust */
        radial-gradient(900px 520px at 18% 22%, rgba(143,243,255,.07), rgba(0,0,0,0) 62%),
        radial-gradient(820px 540px at 82% 28%, rgba(168,160,255,.08), rgba(0,0,0,0) 64%);

      opacity:.75;
      filter: blur(.15px);
      mix-blend-mode: screen;
      transform: translate3d(0,0,0);
      animation: starDrift 28s linear infinite;
    }

    body::after{
      content:"";
      position:fixed;
      inset:-35%;
      pointer-events:none;
      z-index:0;

      background:
        radial-gradient(900px 700px at 30% 30%, rgba(168,160,255,.10), rgba(0,0,0,0) 60%),
        radial-gradient(820px 660px at 70% 40%, rgba(143,243,255,.09), rgba(0,0,0,0) 62%),
        radial-gradient(760px 640px at 55% 75%, rgba(255,255,255,.04), rgba(0,0,0,0) 65%),
        conic-gradient(from 140deg at 50% 50%,
          rgba(143,243,255,0.16),
          rgba(168,160,255,0.14),
          rgba(255,255,255,0.05),
          rgba(143,243,255,0.12));

      opacity:.30;
      filter: blur(30px);
      mix-blend-mode: screen;
      transform: translate3d(0,0,0);
      animation: auroraDrift 16s ease-in-out infinite;
    }

    body > *{ position:relative; z-index:1; }

    @keyframes starDrift{
      0%   { transform: translate(-1.5%, -1.0%); }
      50%  { transform: translate( 1.5%,  1.0%); }
      100% { transform: translate(-1.5%, -1.0%); }
    }
    @keyframes auroraDrift{
      0%   { transform: translate(-4%, -2%) rotate(0deg); }
      50%  { transform: translate( 4%,  3%) rotate(12deg); }
      100% { transform: translate(-4%, -2%) rotate(0deg); }
    }

    /* App container */
    .app{
      width:min(720px, 100%);
      border-radius: var(--radius);
      background:
        radial-gradient(900px 420px at 20% 12%, rgba(255,255,255,0.08), rgba(0,0,0,0) 55%),
        linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)),
        var(--glass);
      border:1px solid rgba(255,255,255,0.12);
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      overflow:hidden;
      padding:22px;
    }

    .screen{ display:none; }
    .screen.active{ display:block; }

    .titleArcade{
      font-family: "Press Start 2P", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      letter-spacing: .8px;
      text-shadow: 0 0 18px rgba(255,255,255,0.10), 0 0 36px rgba(143,243,255,0.12);
      margin:0 0 14px;
      font-size: clamp(18px, 3.2vw, 28px);
      line-height: 1.3;
      text-align:center;
    }

    .copy{
      max-width: 54ch;
      margin: 0 auto;
      text-align:center;
      color: var(--muted);
      line-height: 1.65;
      font-size: 1rem;
    }
    .copy ul{
      list-style: none;
      padding: 0;
      margin: 14px auto 0;
      display: grid;
      gap: 8px;
      width: min(520px, 100%);
    }
    .copy li{
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      border-radius: 14px;
      padding: 10px 12px;
      text-align: left;
    }

    .stack{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:16px;
      padding: 10px 8px 4px;
    }

    /* =========================
       üßø Orb
       ========================= */
    .orbStage{
      width:min(440px, 92vw);
      aspect-ratio: 1 / 1;
      display:grid;
      place-items:center;
      position:relative;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
    }

    .orb{
      width: 78%;
      height: 78%;
      border-radius: 999px;
      position:relative;
      overflow:hidden;
      transform-style: preserve-3d;

      /* Glass shell */
      border: 1px solid rgba(255,255,255,0.18);
      background:
        radial-gradient(circle at 35% 30%,
          rgba(255,255,255,.58),
          rgba(143,243,255,.22) 45%,
          rgba(168,160,255,.14) 72%,
          rgba(0,0,0,0) 82%),
        radial-gradient(circle at 55% 65%,
          rgba(255,255,255,.08),
          rgba(0,0,0,0) 60%);

      box-shadow:
        0 0 38px rgba(143,243,255,.22),
        0 0 120px rgba(168,160,255,.14);

      /* Idle motion */
      animation:
        orbBreathe 6.1s ease-in-out infinite,
        orbRotate 52s linear infinite;
      will-change: transform, filter;
    }

    /* Inner volume haze */
    .orb::before{
      content:"";
      position:absolute;
      inset:-28%;
      background:
        radial-gradient(circle at 25% 30%,
          rgba(255,255,255,.75),
          rgba(255,255,255,.22) 20%,
          rgba(143,243,255,.12) 44%,
          rgba(0,0,0,0) 62%),
        conic-gradient(from 0deg,
          rgba(255,255,255,0.00),
          rgba(255,255,255,0.10),
          rgba(143,243,255,0.10),
          rgba(255,255,255,0.00));
      opacity:0.92;
      mix-blend-mode: screen;
      filter: blur(.2px);
      transform: translate3d(-10%, -12%, 0) rotate(0deg);
      animation: glowOrbit 10.5s linear infinite;
      pointer-events:none;
    }

    /* Glistening highlights (surface flecks) + faint rays */
    .orb::after{
      content:"";
      position:absolute;
      inset:-22%;
      background:
        radial-gradient(10px 10px at 16% 30%, rgba(255,255,255,.44), rgba(0,0,0,0) 60%),
        radial-gradient(12px 12px at 72% 46%, rgba(255,255,255,.34), rgba(0,0,0,0) 62%),
        radial-gradient(9px 9px at 52% 78%, rgba(255,255,255,.30), rgba(0,0,0,0) 60%),
        conic-gradient(from 220deg at 50% 50%,
          rgba(255,255,255,0.00),
          rgba(255,255,255,0.08),
          rgba(143,243,255,0.10),
          rgba(255,255,255,0.00));
      opacity:0.82;
      mix-blend-mode: screen;
      filter: blur(0.25px);
      animation: glistenDrift 12.5s ease-in-out infinite;
      pointer-events:none;
    }

    /* Projection rays around the orb */
    .rays{
      position:absolute;
      inset: 0;
      border-radius: 999px;
      pointer-events:none;
      filter: blur(0.6px);
      opacity: 0.55;
    }
    .rays::before{
      content:"";
      position:absolute;
      inset:-20%;
      background:
        conic-gradient(from 10deg at 50% 50%,
          rgba(255,255,255,0.00),
          rgba(255,255,255,0.06),
          rgba(255,255,255,0.00),
          rgba(143,243,255,0.08),
          rgba(255,255,255,0.00),
          rgba(168,160,255,0.07),
          rgba(255,255,255,0.00));
      opacity:0.7;
      mix-blend-mode: screen;
      animation: raysSlow 18s linear infinite;
    }

    @keyframes orbBreathe{
      0%   { transform: scale(0.96); filter: brightness(0.98) saturate(1.06); }
      45%  { transform: scale(1.02); filter: brightness(1.12) saturate(1.12); }
      100% { transform: scale(0.96); filter: brightness(0.98) saturate(1.06); }
    }
    @keyframes orbRotate{
      to { transform: rotateY(360deg); }
    }
    @keyframes glowOrbit{
      0%   { transform: translate3d(-12%, -14%, 0) rotate(0deg); }
      50%  { transform: translate3d(10%,  12%, 0) rotate(180deg); }
      100% { transform: translate3d(-12%, -14%, 0) rotate(360deg); }
    }
    @keyframes glistenDrift{
      0%   { transform: translate3d(-2%, -1%, 0) rotate(0deg); opacity:0.74; }
      50%  { transform: translate3d( 2%,  1%, 0) rotate(10deg); opacity:0.92; }
      100% { transform: translate3d(-2%, -1%, 0) rotate(0deg); opacity:0.74; }
    }
    @keyframes raysSlow{
      to { transform: rotate(360deg); }
    }

    /* Interaction overlay spawners */
    .fxLayer{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:visible;
    }

    .booInside{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      font-size: clamp(52px, 8vw, 88px);
      opacity:0;
      transform: translateY(3px) scale(0.98);
      filter: drop-shadow(0 0 18px rgba(255,255,255,0.18))
              drop-shadow(0 0 36px rgba(143,243,255,0.10));
      pointer-events:none;
    }

    /* =========================
       üéÆ Arcade UI bits
       ========================= */
    .pressRow{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:14px;
      margin-top: 6px;
      flex-wrap:wrap;
    }

    .arcadeText{
      font-family: "Press Start 2P", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: clamp(12px, 2.0vw, 16px);
      letter-spacing: .6px;
      font-weight: 800;
      color: rgba(244,248,255,0.95);
      text-shadow: 0 0 18px rgba(255,255,255,0.10);
      user-select:none;
    }

    .arcadeBtn{
      width: max(var(--tap), 92px);
      height: max(var(--tap), 92px);
      border-radius: 999px;
      border:1px solid rgba(255,255,255,0.16);
      cursor:pointer;
      position:relative;
      user-select:none;
      -webkit-tap-highlight-color: transparent;

      background:
        radial-gradient(circle at 35% 28%, rgba(255,255,255,0.55), rgba(255,255,255,0.12) 18%, rgba(0,0,0,0) 45%),
        linear-gradient(180deg, rgba(255,255,255,0.14), rgba(0,0,0,0) 45%),
        linear-gradient(180deg, var(--arcadeRed1), var(--arcadeRed2));

      box-shadow:
        0 18px 44px rgba(0,0,0,0.40),
        0 0 0 1px rgba(255,255,255,0.10) inset,
        0 0 26px rgba(255,45,45,0.20);
      transform: translateY(0);
      transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
    }

    .arcadeBtn:active{
      transform: translateY(2px) scale(0.985);
      filter: brightness(0.98);
      box-shadow:
        0 10px 24px rgba(0,0,0,0.34),
        0 0 0 1px rgba(255,255,255,0.10) inset,
        0 0 22px rgba(255,45,45,0.18);
    }

    .startBtn{
      font-family: "Press Start 2P", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      letter-spacing: .8px;
      font-size: clamp(14px, 2.2vw, 18px);
      padding: 18px 22px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.14);
      cursor:pointer;
      background:
        radial-gradient(220px 100px at 20% 0%, rgba(255,255,255,0.20), rgba(0,0,0,0) 70%),
        linear-gradient(180deg, rgba(255,255,255,0.10), rgba(0,0,0,0) 42%),
        linear-gradient(180deg, var(--arcadeBlue1), var(--arcadeBlue2));
      color: rgba(244,248,255,0.98);
      text-shadow: 0 0 16px rgba(255,255,255,0.18);
      box-shadow:
        0 20px 50px rgba(0,0,0,0.42),
        0 0 0 1px rgba(255,255,255,0.10) inset,
        0 0 30px rgba(42,168,255,0.20);
      transition: transform .12s ease, filter .12s ease;
      min-width: 180px;
    }
    .startBtn:active{ transform: translateY(2px) scale(0.99); filter: brightness(0.98); }

    /* Medium transition cues */
    .orbStage.isTransitioning .orb{
      transition: transform 650ms ease, filter 650ms ease;
      filter: brightness(1.08) saturate(1.08);
    }

    /* Disable taps during interaction */
    .isBusy .orbStage,
    .isBusy .arcadeBtn{
      pointer-events:none;
      cursor: default;
    }

    /* =========================
       üéÜ Interactions (visual only)
       Duration: 10‚Äì15s, then return to idle
       ========================= */

    /* 1) Golden Bloom Burst (quick event inside the 10‚Äì15s window) */
    .fx-golden .orb{
      animation:
        orbBreathe 6.1s ease-in-out infinite,
        orbRotate 52s linear infinite,
        goldenBurst 2.4s ease-in-out 0.25s 1;
    }
    @keyframes goldenBurst{
      0%   { transform: scale(1.00); filter: brightness(1.02) saturate(1.06); }
      18%  { transform: scale(1.35); filter: brightness(1.18) saturate(1.10); }
      45%  { transform: scale(3.00); filter: brightness(1.70) saturate(1.06); }
      70%  { transform: scale(1.18); filter: brightness(1.18) saturate(1.08); }
      100% { transform: scale(1.00); filter: brightness(1.02) saturate(1.06); }
    }
    .fx-golden .orb::after{
      animation: glistenDrift 12.5s ease-in-out infinite, goldenGlow 2.4s ease-in-out 0.25s 1;
    }
    @keyframes goldenGlow{
      0%   { opacity:0.70; }
      45%  { opacity:1.00; }
      100% { opacity:0.82; }
    }

    /* 2) Color Drift Morph (slow hue shift then settle) */
    .fx-color .orb{
      animation:
        orbBreathe 6.1s ease-in-out infinite,
        orbRotate 52s linear infinite,
        colorDrift 12.5s ease-in-out 0.1s 1;
    }
    @keyframes colorDrift{
      0%   { filter: hue-rotate(0deg)   brightness(1.05) saturate(1.08); }
      35%  { filter: hue-rotate(55deg)  brightness(1.10) saturate(1.12); }
      70%  { filter: hue-rotate(120deg) brightness(1.08) saturate(1.10); }
      100% { filter: hue-rotate(0deg)   brightness(1.05) saturate(1.08); }
    }

    /* 3) Star Sprinkle Release (spawned elements) */
    .star{
      position:absolute;
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.95), rgba(255,255,255,.35) 45%, rgba(0,0,0,0) 70%);
      filter: blur(0.2px);
      opacity: 0;
      transform: translate3d(0,0,0) scale(0.9);
      mix-blend-mode: screen;
      animation: starFall 6.8s ease-in-out forwards;
    }
    @keyframes starFall{
      0%   { opacity:0; transform: translate3d(var(--sx), var(--sy), 0) scale(0.9); }
      12%  { opacity:0.95; }
      100% { opacity:0; transform: translate3d(calc(var(--sx) + var(--dx)), calc(var(--sy) + var(--dy)), 0) scale(0.75); }
    }

    /* 4) Ripple Touch Echo (spawned elements) */
    .ripple{
      position:absolute;
      left:50%;
      top:50%;
      width: 22%;
      height: 22%;
      border-radius: 999px;
      transform: translate(-50%, -50%) scale(0.8);
      border: 2px solid rgba(255,255,255,0.16);
      box-shadow:
        0 0 22px rgba(143,243,255,0.10),
        0 0 34px rgba(168,160,255,0.08);
      opacity: 0;
      filter: blur(0.15px);
      animation: rippleOut 3.2s ease-out forwards;
    }
    @keyframes rippleOut{
      0%   { opacity:0; transform: translate(-50%, -50%) scale(0.82); }
      18%  { opacity:0.55; }
      100% { opacity:0; transform: translate(-50%, -50%) scale(3.6); }
    }

    /* 5) Peekaboo Boo Reveal */
    .fx-peek .booInside{
      animation: booPeek 6.0s ease-in-out 0.2s 1;
    }
    @keyframes booPeek{
      0%   { opacity:0; transform: translateY(3px) scale(0.98); }
      20%  { opacity:0.95; transform: translateY(0) scale(1.00); }
      70%  { opacity:0.92; transform: translateY(0) scale(1.00); }
      100% { opacity:0; transform: translateY(3px) scale(0.98); }
    }

    /* Welcome orb slightly smaller */
    .welcomeOrb .orb{ width: 64%; height: 64%; }
    .footerHint{
      margin-top: 6px;
      font-size: 0.9rem;
      color: rgba(214,230,255,0.65);
      text-align:center;
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      body::before, body::after, .orb, .orb::before, .orb::after, .rays::before{
        animation: none !important;
      }
      .star, .ripple, .booInside{ animation: none !important; }
    }
  </style>
</head>

<body>
  <main class="app" id="app">
    <!-- Background music only (no interaction SFX). Starts on START click due to autoplay policies. -->
    <audio id="bgm" preload="auto" loop>
      <!-- Change extension/path if needed. Example: assets/music/button-boo.mp3 -->
      <source src="assets/music/button-boo.mp3" type="audio/mpeg">
    </audio>

    <!-- WELCOME -->
    <section class="screen active" id="welcome">
      <div class="stack">
        <h1 class="titleArcade">Button Boo</h1>

        <div class="orbStage welcomeOrb" aria-label="Button Boo orb (welcome)">
          <div class="rays" aria-hidden="true"></div>
          <div class="orb" aria-hidden="true"></div>
        </div>

        <div class="copy">
          <p><strong style="color:rgba(244,248,255,0.95);">This is a sensory cause-and-effect playground.</strong></p>
          <p>
            A first interaction with screens, and a way for your little ones to develop
          </p>
          <ul>
            <li><strong>Cause &amp; effect understanding</strong></li>
            <li><strong>Motor control</strong></li>
            <li><strong>Sensory processing</strong></li>
            <li><strong>Emotional safety with screens</strong></li>
          </ul>
          <p style="margin-top:12px;">
            All without overstimulation, and without ‚Äúwrong‚Äù inputs.
          </p>
        </div>

        <button class="startBtn" id="startBtn" type="button" aria-label="Start Button Boo">
          START
        </button>

        <div class="footerHint">Tap START to begin.</div>
      </div>
    </section>

    <!-- PLAY -->
    <section class="screen" id="play">
      <div class="stack">
        <div class="orbStage" id="orbStage" role="button" tabindex="0" aria-label="Press the orb to play">
          <div class="rays" aria-hidden="true"></div>

          <div class="orb" id="orb">
            <div class="booInside" id="booInside" aria-hidden="true">üëª</div>
            <div class="fxLayer" id="fxLayer" aria-hidden="true"></div>
          </div>
        </div>

        <div class="pressRow" aria-label="Press to play controls">
          <div class="arcadeText">Press to Play</div>
          <button class="arcadeBtn" id="redBtn" type="button" aria-label="Red arcade button"></button>
        </div>
      </div>
    </section>
  </main>

  <script>
    (() => {
      const app = document.getElementById('app');
      const welcome = document.getElementById('welcome');
      const play = document.getElementById('play');
      const startBtn = document.getElementById('startBtn');

      const bgm = document.getElementById('bgm');

      const orbStage = document.getElementById('orbStage');
      const redBtn = document.getElementById('redBtn');
      const fxLayer = document.getElementById('fxLayer');

      let busy = false;
      let busyTimer = null;

      // Interaction durations
      const INTERACTION_MIN_MS = 10_000;
      const INTERACTION_MAX_MS = 15_000;

      // Medium transition
      const TRANSITION_IN_MS = 650;

      function rand(min, max) {
        return Math.random() * (max - min) + min;
      }

      function setScreen(which) {
        welcome.classList.toggle('active', which === 'welcome');
        play.classList.toggle('active', which === 'play');
      }

      async function startMusic() {
        // Try to play; if it fails (policy), user can press again.
        try {
          if (bgm && bgm.paused) {
            bgm.volume = 0.45; // gentle default
            await bgm.play();
          }
        } catch (e) {
          // Intentionally silent: no error UI in v1.
          // Parents can still tap again to allow audio if needed.
        }
      }

      function clearFxLayer() {
        fxLayer.innerHTML = '';
      }

      function setBusy(on) {
        busy = on;
        app.classList.toggle('isBusy', on);
      }

      function addTransitionFlag() {
        orbStage.classList.add('isTransitioning');
        setTimeout(() => orbStage.classList.remove('isTransitioning'), TRANSITION_IN_MS);
      }

      function pickInteraction() {
        // 5 interactions:
        // - fx-golden
        // - fx-color
        // - fx-stars
        // - fx-ripple
        // - fx-peek
        const list = ['fx-golden', 'fx-color', 'fx-stars', 'fx-ripple', 'fx-peek'];
        return list[Math.floor(Math.random() * list.length)];
      }

      function applyInteractionClass(cls) {
        // Put the class on orbStage so it scopes everything
        orbStage.classList.add(cls);
      }

      function removeAllInteractionClasses() {
        orbStage.classList.remove('fx-golden','fx-color','fx-stars','fx-ripple','fx-peek');
      }

      // ---- FX spawners (visual only) ----
      function spawnStars() {
        // Gentle sprinkle: few larger soft stars, slow fall, no clutter.
        const count = Math.floor(rand(14, 22));
        for (let i = 0; i < count; i++) {
          const s = document.createElement('div');
          s.className = 'star';

          // Start near orb center-ish with slight scatter
          const sx = rand(-10, 10);
          const sy = rand(-10, 10);

          // Drift outward and slightly downward
          const dx = rand(-120, 120);
          const dy = rand(140, 260);

          s.style.setProperty('--sx', sx + 'px');
          s.style.setProperty('--sy', sy + 'px');
          s.style.setProperty('--dx', dx + 'px');
          s.style.setProperty('--dy', dy + 'px');

          // Place at center of orb
          s.style.left = '50%';
          s.style.top = '50%';

          // Variation
          const size = rand(6, 11);
          s.style.width = size + 'px';
          s.style.height = size + 'px';
          s.style.animationDelay = rand(0, 1.8) + 's';
          s.style.opacity = '0';

          fxLayer.appendChild(s);
        }
      }

      function spawnRipples() {
        // A few ripples over the full 10‚Äì15s
        const pulses = Math.floor(rand(4, 7));
        for (let i = 0; i < pulses; i++) {
          const r = document.createElement('div');
          r.className = 'ripple';
          r.style.animationDelay = (i * rand(1.1, 1.8)) + 's';
          fxLayer.appendChild(r);
        }
      }

      function startInteraction() {
        if (busy) return;

        setBusy(true);
        addTransitionFlag();

        const cls = pickInteraction();
        removeAllInteractionClasses();
        clearFxLayer();

        // Apply after a medium transition-in (feels like ‚Äúinhale‚Äù)
        setTimeout(() => {
          applyInteractionClass(cls);

          // Spawn FX for those interactions that need DOM elements
          if (cls === 'fx-stars') spawnStars();
          if (cls === 'fx-ripple') spawnRipples();
        }, TRANSITION_IN_MS);

        const duration = Math.floor(rand(INTERACTION_MIN_MS, INTERACTION_MAX_MS));

        // End: return to idle
        busyTimer = setTimeout(() => {
          removeAllInteractionClasses();
          clearFxLayer();
          setBusy(false);
        }, duration);
      }

      // ---- Events ----
      startBtn.addEventListener('click', async () => {
        await startMusic();
        setScreen('play');
      });

      redBtn.addEventListener('click', () => {
        startInteraction();
      });

      orbStage.addEventListener('click', () => {
        startInteraction();
      });

      // Keyboard accessibility (nice for dev/testing)
      orbStage.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          startInteraction();
        }
      });

      // Safety: if the tab becomes hidden, stop interaction + clear busy
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          if (busyTimer) clearTimeout(busyTimer);
          removeAllInteractionClasses();
          clearFxLayer();
          setBusy(false);
        }
      });
    })();
  </script>
</body>
</html>
